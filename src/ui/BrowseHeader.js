import React from "react";
import CategoryCard from "./CategoryCard";
const A16zBackground2 = () => {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="211"
      height="35"
      viewBox="0 0 211 35"
      fill="none"
      preserveAspectRatio="xMaxYMax slice"
      className="absolute right-0 bottom-0"
    >
      <g opacity="0.9">
        <path
          d="M111.421 35.9736H113.747V31.2493H111.421V35.9736Z"
          fill="#4343FF"
        />
        <path
          d="M118.386 31.2393H120.767V26.5149H118.386V31.2393Z"
          fill="#5A4CFF"
        />
        <path
          d="M125.337 35.9736H127.813V31.2493H125.337V35.9736Z"
          fill="#7064FF"
        />
        <path
          d="M125.393 31.2393H127.773V26.5149H125.393V31.2393Z"
          fill="#7E4BFF"
        />
        <path
          d="M132.412 35.9736H134.738V31.2493H132.412V35.9736Z"
          fill="#4040FF"
        />
        <path
          d="M132.439 26.5151H134.711V21.7908H132.439V26.5151Z"
          fill="#4C23FF"
        />
        <path
          d="M139.35 35.9736H141.785V31.2493H139.35V35.9736Z"
          fill="#675CFF"
        />
        <path
          d="M139.378 31.2393H141.759V26.5149H139.378V31.2393Z"
          fill="#AB4EFF"
        />
        <path
          d="M139.378 26.5151H141.759V21.7908H139.378V26.5151Z"
          fill="#AB4EFF"
        />
        <path
          d="M146.411 35.9736H148.737V31.2493H146.411V35.9736Z"
          fill="#FF39FF"
        />
        <path
          d="M146.384 31.2393H148.765V26.5149H146.384V31.2393Z"
          fill="#FF52CC"
        />
        <path
          d="M146.384 26.5151H148.765V21.7908H146.384V26.5151Z"
          fill="#FF52CC"
        />
        <path
          d="M146.261 17.0576H148.873V12.3333H146.261V17.0576Z"
          fill="#FF84DA"
        />
        <path
          d="M153.39 35.9736H155.743V31.2493H153.39V35.9736Z"
          fill="#5448FF"
        />
        <path
          d="M153.363 31.2393H155.771V26.5149H153.363V31.2393Z"
          fill="#FF52F4"
        />
        <path
          d="M153.363 26.5151H155.771V21.7908H153.363V26.5151Z"
          fill="#FF52F4"
        />
        <path
          d="M153.363 17.0576H155.771V12.3333H153.363V17.0576Z"
          fill="#FF5AB7"
        />
        <path
          d="M160.383 35.9736H162.736V31.2493H160.383V35.9736Z"
          fill="#5F4AFF"
        />
        <path
          d="M160.383 31.2393H162.736V26.5149H160.383V31.2393Z"
          fill="#6746FF"
        />
        <path
          d="M160.383 26.5151H162.736V21.7908H160.383V26.5151Z"
          fill="#6746FF"
        />
        <path
          d="M160.41 21.7915H162.709V17.0672H160.41V21.7915Z"
          fill="#EC35FF"
        />
        <path
          d="M160.315 12.3325H162.791V7.60817H160.315V12.3325Z"
          fill="#FF67D0"
        />
        <path
          d="M167.375 35.9736H169.729V31.2493H167.375V35.9736Z"
          fill="#634FFF"
        />
        <path
          d="M167.361 31.2393H169.742V26.5149H167.361V31.2393Z"
          fill="#8F4EFF"
        />
        <path
          d="M167.361 26.5151H169.742V21.7908H167.361V26.5151Z"
          fill="#8F4EFF"
        />
        <path
          d="M167.361 21.7915H169.742V17.0672H167.361V21.7915Z"
          fill="#B053FF"
        />
        <path
          d="M167.361 17.0576H169.742V12.3333H167.361V17.0576Z"
          fill="#B053FF"
        />
        <path
          d="M167.307 7.60889H169.783V2.88454H167.307V7.60889Z"
          fill="#FF65D0"
        />
        <path
          d="M174.395 35.9736H176.722V31.2493H174.395V35.9736Z"
          fill="#5941FF"
        />
        <path
          d="M174.341 31.2393H176.776V26.5149H174.341V31.2393Z"
          fill="#8E5DFF"
        />
        <path
          d="M174.341 26.5151H176.776V21.7908H174.341V26.5151Z"
          fill="#8E5DFF"
        />
        <path
          d="M174.259 21.7915H176.844V17.0672H174.259V21.7915Z"
          fill="#E6C3FF"
        />
        <path
          d="M174.395 12.3325H176.722V7.60817H174.395V12.3325Z"
          fill="#9D42FF"
        />
        <path
          d="M181.374 35.9736H183.728V31.2493H181.374V35.9736Z"
          fill="#6B4DFF"
        />
        <path
          d="M181.387 31.2393H183.714V26.5149H181.387V31.2393Z"
          fill="#853FFF"
        />
        <path
          d="M181.387 26.5151H183.714V21.7908H181.387V26.5151Z"
          fill="#853FFF"
        />
        <path
          d="M181.36 21.7915H183.741V17.0672H181.36V21.7915Z"
          fill="#A953FF"
        />
        <path
          d="M181.36 17.0576H183.741V12.3333H181.36V17.0576Z"
          fill="#A953FF"
        />
        <path
          d="M181.415 12.3325H183.687V7.60817H181.415V12.3325Z"
          fill="#DF21FF"
        />
        <path
          d="M181.347 7.60889H183.755V2.88454H181.347V7.60889Z"
          fill="#D354FF"
        />
        <path
          d="M188.394 35.9736H190.693V31.2493H188.394V35.9736Z"
          fill="#6A3CFF"
        />
        <path
          d="M188.381 31.2393H190.707V26.5149H188.381V31.2393Z"
          fill="#6B48FF"
        />
        <path
          d="M188.381 26.5151H190.707V21.7908H188.381V26.5151Z"
          fill="#6B48FF"
        />
        <path
          d="M188.244 21.7915H190.829V17.0672H188.244V21.7915Z"
          fill="#CD78FF"
        />
        <path
          d="M188.244 17.0576H190.829V12.3333H188.244V17.0576Z"
          fill="#CD78FF"
        />
        <path
          d="M188.394 12.3325H190.693V7.60817H188.394V12.3325Z"
          fill="#B535FF"
        />
        <path
          d="M188.394 2.88477H190.693V-1.83958H188.394V2.88477Z"
          fill="#A135FF"
        />
        <path
          d="M195.414 35.9736H197.686V31.2493H195.414V35.9736Z"
          fill="#5B28FF"
        />
        <path
          d="M195.4 31.2393H197.699V26.5149H195.4V31.2393Z"
          fill="#6F39FF"
        />
        <path
          d="M195.4 26.5151H197.699V21.7908H195.4V26.5151Z"
          fill="#6F39FF"
        />
        <path
          d="M195.4 21.7915H197.699V17.0672H195.4V21.7915Z"
          fill="#9736FF"
        />
        <path
          d="M195.4 17.0576H197.699V12.3333H195.4V17.0576Z"
          fill="#9736FF"
        />
        <path
          d="M195.414 7.60889H197.686V2.88454H195.414V7.60889Z"
          fill="#8D2BFF"
        />
        <path
          d="M202.38 35.9736H204.706V31.2493H202.38V35.9736Z"
          fill="#6F42FF"
        />
        <path
          d="M202.366 31.2393H204.72V26.5149H202.366V31.2393Z"
          fill="#814DFF"
        />
        <path
          d="M202.366 26.5151H204.72V21.7908H202.366V26.5151Z"
          fill="#814DFF"
        />
        <path
          d="M202.366 21.7915H204.72V17.0672H202.366V21.7915Z"
          fill="#A748FF"
        />
        <path
          d="M202.366 17.0576H204.72V12.3333H202.366V17.0576Z"
          fill="#A748FF"
        />
        <path
          d="M202.407 12.3325H204.679V7.60817H202.407V12.3325Z"
          fill="#A522FF"
        />
        <path
          d="M202.38 7.60889H204.706V2.88454H202.38V7.60889Z"
          fill="#BB41FF"
        />
        <path
          d="M202.38 2.88477H204.706V-1.83958H202.38V2.88477Z"
          fill="#BB41FF"
        />
        <path
          d="M209.358 35.9736H211.712V31.2493H209.358V35.9736Z"
          fill="#794AFF"
        />
        <path
          d="M209.372 31.2393H211.698V26.5149H209.372V31.2393Z"
          fill="#7F3FFF"
        />
        <path
          d="M209.372 26.5151H211.698V21.7908H209.372V26.5151Z"
          fill="#7F3FFF"
        />
        <path
          d="M209.4 21.7915H211.672V17.0672H209.4V21.7915Z"
          fill="#781CFF"
        />
        <path
          d="M209.4 17.0576H211.672V12.3333H209.4V17.0576Z"
          fill="#781CFF"
        />
        <path
          d="M209.372 12.3325H211.698V7.60817H209.372V12.3325Z"
          fill="#9D42FF"
        />
        <path
          d="M209.4 7.60889H211.672V2.88454H209.4V7.60889Z"
          fill="#991CFF"
        />
        <path
          d="M209.4 2.88477H211.672V-1.83958H209.4V2.88477Z"
          fill="#991CFF"
        />
      </g>
      <g opacity="0.6" filter="url(#filter0_f_1206_34095)">
        <ellipse
          cx="201"
          cy="50.118"
          rx="152.095"
          ry="88.662"
          fill="url(#paint0_radial_1206_34095)"
        />
      </g>
      <defs>
        <filter
          id="filter0_f_1206_34095"
          x="0.904297"
          y="-86.5439"
          width="400.19"
          height="273.324"
          filterUnits="userSpaceOnUse"
          color-interpolation-filters="sRGB"
        >
          <feFlood flood-opacity="0" result="BackgroundImageFix" />
          <feBlend
            mode="normal"
            in="SourceGraphic"
            in2="BackgroundImageFix"
            result="shape"
          />
          <feGaussianBlur
            stdDeviation="24"
            result="effect1_foregroundBlur_1206_34095"
          />
        </filter>
        <radialGradient
          id="paint0_radial_1206_34095"
          cx="0"
          cy="0"
          r="1"
          gradientUnits="userSpaceOnUse"
          gradientTransform="translate(201 50.118) rotate(90) scale(88.662 152.095)"
        >
          <stop stop-color="#4112FF" stop-opacity="0.55" />
          <stop offset="0.490375" stop-color="#B012FF" stop-opacity="0.55" />
          <stop offset="1" stop-opacity="0" />
        </radialGradient>
      </defs>
    </svg>
  );
};
export default function BrowseHeader({
  search,
  setSearch,
  searchInputRef,
  isMobile,
  categories,
  categoryCounts,
  selectedCategories,
  toggleCategory,
  onFilterToggle,
}) {
  const [filtersOpen, setFiltersOpen] = React.useState(false);
  const headerRef = React.useRef(null);

  // Lock body scroll when filters open
  React.useEffect(() => {
    if (filtersOpen && isMobile) {
      // Lock body scroll
      document.body.style.overflow = "hidden";
    } else {
      // Unlock body scroll
      document.body.style.overflow = "";
    }

    // Cleanup on unmount
    return () => {
      document.body.style.overflow = "";
    };
  }, [filtersOpen, isMobile]);

  const handleFilterToggle = () => {
    const newState = !filtersOpen;
    setFiltersOpen(newState);
    // Notify parent to scroll to results
    if (newState && onFilterToggle) {
      onFilterToggle();
    }
  };

  const handleCategoryClick = (name) => {
    toggleCategory(name);
    // Auto-dismiss filters after selection
    setFiltersOpen(false);
  };

  return (
    <>
      {/* Overlay */}
      {isMobile && filtersOpen && (
        <div
          className="fixed inset-0 bg-black/80 z-10"
          onClick={() => setFiltersOpen(false)}
        />
      )}

      <div
        ref={headerRef}
        className={`sticky top-0 z-20 bg-black ${
          isMobile ? (filtersOpen ? "pb-0" : "pb-4") : "pb-6"
        }`}
      >
        <div
          className={`${isMobile ? "pt-4" : "pt-6"} flex items-center ${
            isMobile ? "justify-between" : "justify-between"
          } gap-3`}
        >
          {!isMobile && (
            <div className="text-white text-[1.75rem] font-[700] uppercase">
              Browse Offers
            </div>
          )}
          <div
            className={`flex items-center ${
              isMobile ? "w-full" : "flex-1 max-w-[26rem]"
            }`}
          >
            <div className="relative flex-1">
              <input
                type="text"
                value={search}
                onChange={(e) => setSearch(e.target.value)}
                placeholder="Search Offers..."
                className={`w-full appearance-none text-[0.875rem] font-500 leading-[1.25] tracking-[-0.02188rem] text-white placeholder-white/60 border-[1px] border-[#979797] bg-[#2d2d2d] ${
                  isMobile ? "px-3 pr-8" : "px-4 pr-10"
                } py-2 focus:outline-none focus:border-white transition-colors`}
                ref={searchInputRef}
              />
              {search && (
                <button
                  onClick={() => setSearch("")}
                  className="absolute right-2 top-1/2 -translate-y-1/2 text-white/60 hover:text-white transition-colors"
                  aria-label="Clear search"
                >
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 20 20"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M15 5L5 15M5 5L15 15"
                      stroke="currentColor"
                      strokeWidth="2"
                      strokeLinecap="round"
                      strokeLinejoin="round"
                    />
                  </svg>
                </button>
              )}
            </div>
            {isMobile && (
              <button
                onClick={handleFilterToggle}
                className="flex appearance-none items-center justify-center gap-2 px-3 py-2 bg-white text-black text-[0.75rem] font-[700] uppercase tracking-wide whitespace-nowrap flex-shrink-0 border-solid border-[1px] border-white"
              >
                <svg
                  width="16"
                  height="17"
                  viewBox="0 0 16 17"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                  xmlnsXlink="http://www.w3.org/1999/xlink"
                  className="flex-shrink-0"
                >
                  <rect
                    y="0.5"
                    width="16"
                    height="16"
                    fill="url(#pattern0_1202_135543)"
                  />
                  <defs>
                    <pattern
                      id="pattern0_1202_135543"
                      patternContentUnits="objectBoundingBox"
                      width="1"
                      height="1"
                    >
                      <use
                        xlinkHref="#image0_1202_135543"
                        transform="scale(0.01)"
                      />
                    </pattern>
                    <image
                      id="image0_1202_135543"
                      width="100"
                      height="100"
                      preserveAspectRatio="none"
                      xlinkHref="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAADMklEQVR4nO2cQYjMURzHP3ZQaJISNcqJA3HYPUi2Ngcue1hu7k6U7G6UcHk3q5zMiVxcnKRk5SBXDoTDJEVRxEVtUqvZMHr1V5us3n935v1/7/2/n3q37f//vf+nmfnM7PwHhBBCCCGEEEIIIYTIn7XAEeCcFovXBLAmtoydwGugp8W/1itgR8xHhmQQJCXKI+Wogc32Eln+6WvgXDCw0V4i63wMIc7ARnuJLH+tJAQ7S0KwtUwImQee1WTNpyCkQ33oSIgtkhDyGWiSP81ir+aF+PUAWE2+NIC7Vl7UTwYWxnXypR14DU7EGGYv8CtwoEnyYzJw7z+BPbGGuhE41I9Yn+dEYqLYU8je/TWKxjrgSeBgvtX3kT7DwLfAPfv3KBtiD7gZeBs44CdgO+nSAj4E7vUdsLWqQXcBc4GD+mbfSJp5+zJwj1+L19hKOQh0AwdOLYcbgXnr1wJwGCMcDxw6tRxul9iXfztgisslhk8hh6dK7GcGg6wCbpVodP+vYKuMl8jb28AQRvE5/DjxHB4ukbdPq8jbOuVwK5W8rUMON1PL25xzuJFq3uaaw+2U83aQOTxVwXzTqedtTjk8nkve5pDDIyXzdj2Z4XP4jZEcbuWatynmcDP3vE0phxt1ydtUcrhd4rxRvqBgiZnIOTxd4nyXqCExc3i8rnlrMYdH6p63lnK4pbxdHrtL5PDzwJsp/d+8CDzmXDGDWMShIjVDLuCpgOOdDjzWQnFusYIcvh9wLP8eRnkbKYc7fbh3I5tPbwfNEDAbQchsnfO2iru0Ohbu3cgFJyG2cBJiCychtnASYgsnIbZwEmILJyG2cBJiCychtnASYgsnIbZwEmILJyG2cBJiCychtnASYgsnIbZwEmILJyFpCflYfCvxf0hI5B/a7ALXgG1LHENCKvo58+4SYiSkj5wpIeTP+g5cXfRUJiF9ZGwZQv4W815C+svDFUgJWRJSkk3AHQmxxyhwT0LyF+Oq3lAujPZJjIQYE+Oq3kDOifxoGUIuVj147oyVFHOs6oHrwliAGH97de3vR7ci5gtwoOrh6sx+4ApwEzgLbKl6ICGEEEIIIYTAEL8BOfiXXcVozjAAAAAASUVORK5CYII="
                    />
                  </defs>
                </svg>
                FILTERS
              </button>
            )}
          </div>
        </div>

        {/* Mobile filters dropdown */}
        {isMobile && filtersOpen && (
          <div className="flex flex-col">
            {categories.map((name) => {
              const count = categoryCounts.get(name) || 0;
              const isDisabled = count === 0;
              return (
                <div
                  key={name}
                  className={`border-l-[1px] border-r-[1px] border-b-[1px] border-white/80 py-[0.58rem] pl-3 relative overflow-hidden ${
                    isDisabled
                      ? "bg-black/50 text-white/40 cursor-not-allowed"
                      : selectedCategories.has(name)
                      ? "bg-white text-black cursor-pointer"
                      : "bg-black text-white cursor-pointer"
                  } text-[1rem] font-[700] Capitalized leading-1`}
                  onClick={() => !isDisabled && handleCategoryClick(name)}
                >
                  {name === "A16z Speedrun Portfolio" && !isDisabled && (
                    <A16zBackground2 />
                  )}
                  <span>{name}</span>{" "}
                  <span className="text-[0.875rem] font-[500]">({count})</span>
                </div>
              );
            })}
          </div>
        )}
      </div>
    </>
  );
}
